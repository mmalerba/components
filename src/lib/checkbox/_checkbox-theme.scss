@import '@material/checkbox/mixins';
@import '@material/ripple/mixins';
@import '@material/theme/functions';
@import '../core/theming/theming';
@import '../core/typography/typography-utils';
@import '../../cdk/a11y/a11y';


@mixin mat-checkbox-theme-classic($theme) {
  $is-dark-theme: map-get($theme, is-dark);
  $primary: map-get($theme, primary);
  $accent: map-get($theme, accent);
  $warn: map-get($theme, warn);
  $background: map-get($theme, background);


  // The color of the checkbox's checkmark / mixedmark.
  $checkbox-mark-color: mat-color($background, background);

  // NOTE(traviskaufman): While the spec calls for translucent blacks/whites for disabled colors,
  // this does not work well with elements layered on top of one another. To get around this we
  // blend the colors together based on the base color and the theme background.
  $white-30pct-opacity-on-dark: #686868;
  $black-26pct-opacity-on-light: #b0b0b0;
  $disabled-color: if($is-dark-theme, $white-30pct-opacity-on-dark, $black-26pct-opacity-on-light);

  .mat-checkbox-frame {
    border-color: mat-color(map-get($theme, foreground), secondary-text);
  }

  .mat-checkbox-checkmark {
    fill: $checkbox-mark-color;
  }

  .mat-checkbox-checkmark-path {
    // !important is needed here because a stroke must be set as an
    // attribute on the SVG in order for line animation to work properly.
    stroke: $checkbox-mark-color !important;

    @include cdk-high-contrast(black-on-white) {
      // Having the one above be !important ends up overriding the browser's automatic
      // color inversion so we need to re-invert it ourselves for black-on-white.
      stroke: #000 !important;
    }
  }

  .mat-checkbox-mixedmark {
    background-color: $checkbox-mark-color;
  }

  .mat-checkbox-indeterminate, .mat-checkbox-checked {
    &.mat-primary .mat-checkbox-background {
      background-color: mat-color($primary);
    }

    &.mat-accent .mat-checkbox-background {
      background-color: mat-color($accent);
    }

    &.mat-warn .mat-checkbox-background {
      background-color: mat-color($warn);
    }
  }

  .mat-checkbox-disabled {
    &.mat-checkbox-checked:not(.mat-checkbox-indeterminate) {
      .mat-checkbox-background {
        background-color: $disabled-color;
      }
    }

    &:not(.mat-checkbox-checked) {
      .mat-checkbox-frame {
        border-color: $disabled-color;
      }
    }

    .mat-checkbox-label {
      color: $disabled-color;
    }

    @include cdk-high-contrast {
      opacity: 0.5;
    }
  }

  // This one is moved down here so it can target both
  // the theme colors and the disabled state.
  @include cdk-high-contrast {
    .mat-checkbox-background {
      // Needs to be removed because it hides the checkbox outline.
      background: none;
    }
  }

  .mat-checkbox:not(.mat-checkbox-disabled) {
    &.mat-primary .mat-checkbox-ripple .mat-ripple-element {
      background-color: mat-color($primary);
    }

    &.mat-accent .mat-checkbox-ripple .mat-ripple-element {
      background-color: mat-color($accent);
    }

    &.mat-warn .mat-checkbox-ripple .mat-ripple-element {
      background-color: mat-color($warn);
    }
  }
}

@mixin mat-checkbox-typography($config) {
  .mat-checkbox {
    font-family: mat-font-family($config);
  }

  // TODO(kara): Remove this style when fixing vertical baseline
  .mat-checkbox-layout .mat-checkbox-label {
    line-height: mat-line-height($config, body-2);
  }
}


@mixin mat-checkbox-theme($theme, $mdc: (checkbox: both)) {
  $mdc-mode: map-get($mdc, checkbox) or classic;

  @if ($mdc-mode == classic or $mdc-mode == both) {
    @include mat-checkbox-theme-classic($theme);
  }
  @if ($mdc-mode == mdc or $mdc-mode == both) {
    $primary: mat-color(map-get($theme, primary));
    $accent: mat-color(map-get($theme, accent));
    $warn: mat-color(map-get($theme, warn));
    $background: mat-color(map-get($theme, background), background);

    $mdc-theme-primary: $primary !global;
    $mdc-theme-on-primary: if(mdc-theme-contrast-tone($mdc-theme-primary) == "dark", #000, #fff) !global;

    $mdc-theme-secondary: $accent !global;
    $mdc-theme-on-secondary: if(mdc-theme-contrast-tone($mdc-theme-secondary) == "dark", #000, #fff) !global;

    $mdc-theme-background: $background !global;

    $mdc-theme-surface: $background !global;
    $mdc-theme-on-surface: if(mdc-theme-contrast-tone($mdc-theme-surface) == "dark", #000, #fff) !global;

    $mdc-theme-error: $warn !global;
    $mdc-theme-on-error: if(mdc-theme-contrast-tone($mdc-theme-error) == "dark", #000, #fff) !global;

    $mdc-theme-property-values: (
      // Primary
        primary: $mdc-theme-primary,
      // Secondary
        secondary: $mdc-theme-secondary,
      // Background
        background: $mdc-theme-background,
      // Surface
        surface: $mdc-theme-surface,
      // Error
        error: $mdc-theme-error,
        on-primary: $mdc-theme-on-primary,
        on-secondary: $mdc-theme-on-secondary,
        on-surface: $mdc-theme-on-surface,
        on-error: $mdc-theme-on-error,
      // Text-primary on "background" background
        text-primary-on-background: mdc-theme-ink-color-for-fill_(primary, $mdc-theme-background),
        text-secondary-on-background: mdc-theme-ink-color-for-fill_(secondary, $mdc-theme-background),
        text-hint-on-background: mdc-theme-ink-color-for-fill_(hint, $mdc-theme-background),
        text-disabled-on-background: mdc-theme-ink-color-for-fill_(disabled, $mdc-theme-background),
        text-icon-on-background: mdc-theme-ink-color-for-fill_(icon, $mdc-theme-background),
      // Text-primary on "light" background
        text-primary-on-light: mdc-theme-ink-color-for-fill_(primary, light),
        text-secondary-on-light: mdc-theme-ink-color-for-fill_(secondary, light),
        text-hint-on-light: mdc-theme-ink-color-for-fill_(hint, light),
        text-disabled-on-light: mdc-theme-ink-color-for-fill_(disabled, light),
        text-icon-on-light: mdc-theme-ink-color-for-fill_(icon, light),
      // Text-primary on "dark" background
        text-primary-on-dark: mdc-theme-ink-color-for-fill_(primary, dark),
        text-secondary-on-dark: mdc-theme-ink-color-for-fill_(secondary, dark),
        text-hint-on-dark: mdc-theme-ink-color-for-fill_(hint, dark),
        text-disabled-on-dark: mdc-theme-ink-color-for-fill_(disabled, dark),
        text-icon-on-dark: mdc-theme-ink-color-for-fill_(icon, dark)
    ) !global;

    .mdc-checkbox {
      @include mdc-states($mdc-checkbox-baseline-theme-color);
    }

    @include mdc-checkbox-ink-color($mdc-checkbox-mark-color);
    @include mdc-checkbox-focus-indicator-color($mdc-checkbox-baseline-theme-color);
    @include mdc-checkbox-container-colors;
    @include mdc-checkbox-disabled-container-color_;
  }
}
